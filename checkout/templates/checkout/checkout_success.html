{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'checkout/css/checkout.css' %}">
{% endblock %}

{% block meta %}
<meta name="description" content="Thank you for shopping at Nourish Bakery! Order confirmation and details of your recent purchase.">
<meta name="robots" content="index, follow">
<title>Order Confirmation | Nourish Bakery</title>
{% endblock %}

{% block body_class %}plain-page{% endblock %}

{% block page_header %}
  <div class="container pt-1 mt-0"></div>
{% endblock %}

{% block content %}
<div class="overlay"></div>
<div class="container">
  <div class="row">
    <div class="col">
      <hr>
      <h2 class="logo-font mb-4">Thank You</h2>
      <hr>
      <p class="text-black">
        Your order information is below. A confirmation email has been sent to
        <strong>{{ order.email }}</strong>.
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col-12 col-lg-7">
      <div class="order-confirmation-wrapper p-2 border">
        
        <!-- Order Info -->
        <div class="row">
          <div class="col"><small class="text-muted">Order Info:</small></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Order Number</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.order_number }}</p></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Order Date</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.date }}</p></div>
        </div>

        <!-- Order Details -->
        <div class="row">
          <div class="col"><small class="text-muted">Order Details:</small></div>
        </div>

        {% for item in order.lineitems.all %}
        <div class="row align-items-center py-2 border-top">
          <div class="col-9 col-md-8">
            <p class="small mb-0 text-black font-weight-bold">
              {{ item.product.name }}{% if item.product_size %} — Size {{ item.product_size|upper }}{% endif %}
            </p>
          </div>
          <div class="col-12 col-md-4 text-md-right mt-2 mt-md-0">
            <p class="small mb-0">Qty: {{ item.quantity }}</p>
            <p class="small mb-0">€{{ item.product.price|floatformat:2 }} each</p>
          </div>
        </div>
        {% endfor %}

        <!-- Delivery Info -->
        <div class="row mt-3">
          <div class="col"><small class="text-muted">Delivering To:</small></div>
        </div>

        <!-- Explicit/manual delivery fields -->
        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Full Name</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.full_name }}</p></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Address 1</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.street_address1 }}</p></div>
        </div>

        {% if order.street_address2 %}
        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Address 2</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.street_address2 }}</p></div>
        </div>
        {% endif %}

        {% if order.county %}
        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">County</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.county }}</p></div>
        </div>
        {% endif %}

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Town or City</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.town_or_city }}</p></div>
        </div>

        {% if order.postcode %}
        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Postal Code</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.postcode }}</p></div>
        </div>
        {% endif %}

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Country</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.country }}</p></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Phone Number</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">{{ order.phone_number }}</p></div>
        </div>

        <!-- Billing Info -->
        <div class="row mt-3">
          <div class="col"><small class="text-muted">Billing Info:</small></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Order Total</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">€{{ order.order_total|floatformat:2 }}</p></div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Delivery</p></div>
          <div class="col-12 col-md-8 text-md-right"><p class="mb-0">€{{ order.delivery_cost|floatformat:2 }}</p></div>
        </div>

        <!-- Display applied discount percentage when available -->
        {% if order.discount_percent %}
        <div class="row">
          <div class="col-12 col-md-4">
            <p class="mb-0 text-black font-weight-bold">Discount ({{ order.discount_percent }}%)</p>
          </div>
          <div class="col-12 col-md-8 text-md-right">
            <p class="mb-0 text-success">−{{ order.discount_percent }}%</p>
          </div>
        </div>
        {% endif %}

        <div class="row">
          <div class="col-12 col-md-4"><p class="mb-0 text-black font-weight-bold">Grand Total</p></div>
          <div class="col-12 col-md-8 text-md-right">
            <p class="mb-0 font-weight-bold text-success">€{{ order.grand_total|floatformat:2 }}</p>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ✅ Back to Products button -->
  <div class="row">
    <div class="col-12 col-lg-7 text-right">
      <a href="/products/" class="btn btn-black rounded-0 my-2">
        <i class="fas fa-gifts mr-2"></i>
        <span class="text-uppercase">Back to Products</span>
      </a>
    </div>
  </div>
</div>
{% endblock %}
